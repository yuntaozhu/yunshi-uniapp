(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages_category_page1-goodsModule-invitePoster"],{"071b":function(e,t,n){"use strict";var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a(n("1ebd"));var i=n("b1a1"),o=n("7df2"),s=n("85d9"),r={data:function(){return{data:{},canvasWidth:0,codeImg:"",codeImg2:"",headImage:"",image:"",qrcode:"",qrcodeimg:""}},onLoad:function(e){this.data=JSON.parse(e.data),this.getShare()},methods:{savePoster:function(e){if(1==e){uni.showLoading({title:"保存中..."}),console.log(9999);var t=this;setTimeout((function(){uni.canvasToTempFilePath({fileType:"png",quality:0,canvasId:"posterCanvas",success:function(e){console.log(e.tempFilePath,"test"),t.saveDownload(e.tempFilePath)},fail:function(){uni.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),uni.hideLoading()}})}),5e3)}else if(2==e){uni.showLoading({title:"图片生成中..."});setTimeout((function(){uni.canvasToTempFilePath({fileType:"png",quality:0,canvasId:"posterCanvas",success:function(e){uni.downloadFile({url:e.tempFilePath,success:function(e){200===e.statusCode&&(uni.hideLoading(),uni.showModal({title:"提示",content:"长按即可保存图片",confirmText:"确定",cancelText:"取消",success:function(t){t.confirm&&uni.previewImage({current:e.tempFilePath,urls:[e.tempFilePath]})}}))}})},fail:function(e){console.log(e.errMsg),uni.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"})}})}),5e3)}},saveDownload:function(e){uni.downloadFile({url:e,success:function(t){400!==t.statusCode&&200!==t.statusCode||(console.log(2222),uni.saveImageToPhotosAlbum({filePath:e,success:function(e){console.log(3333),uni.hideLoading(),uni.showToast({title:"图片保存成功~",duration:2e3})},fail:function(e){"saveImageToPhotosAlbum:fail auth deny"===e.errMsg?(that.$store.dispatch("SetPhoneShow",1),uni.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"})):uni.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),uni.hideLoading()}}))}})},getShare:function(){var e=this;o.request(s.getShare,{collageId:this.data.collageId,orderId:this.data.orderId,productId:this.data.productId,skuId:this.data.skuId,type:0},"GET").then((function(t){e.qrcode=t.data.qrcode,e.getCanvas()})).catch((function(e){}))},getCanvas:function(){var e=this;uni.getImageInfo({src:e.data.headImage,success:function(t){e.headImage=t.path,uni.getImageInfo({src:e.data.image,success:function(t){e.image=t.path,uni.getImageInfo({src:e.qrcode,success:function(t){e.qrcodeimg=t.path,setTimeout((function(){var t=uni.createCanvasContext("posterCanvas");t.setFillStyle("#FFFFFF"),t.fillRect(15,0,820,1e3),e.drawRound(t,25,160,28,e.headImage),t.setFontSize(14),t.setFillStyle("#333333"),t.fillText("发现一件好物，快来和我一起拼",89,120),t.drawImage(e.image,25,150,310,200),t.setFontSize(14),t.setFillStyle("#333333"),t.fillText(e.data.productName,40,390),t.setFontSize(14),t.setFillStyle("#C5AA7B"),t.fillText(e.data.person+"人团",40,430),t.setFontSize(24),t.setFillStyle("#C5AA7B"),t.fillText("¥"+e.data.price,40,470),t.setFontSize(14),t.setFillStyle("#999999"),t.fillText("原价：¥"+e.data.originalPrice,120,468),t.drawImage(e.qrcodeimg,245,370,80,80),t.setFontSize(14),t.setStrokeStyle("#666666"),t.fillText("扫描二维码",250,468),t.draw()}),1500)}})}})}})},exportImg:function(){uni.canvasToTempFilePath({fileType:"jpg",canvasId:"couponQrcode",success:function(e){var t=this;(0,i.base64ToPath)(e.tempFilePath).then((function(e){t.codeImg=e})).catch((function(e){console.error(e)}))}})},drawRound:function(e,t,n,a,i){e.save();t=t;var o=2*t,s=n+t,r=a+t;e.arc(s,r,t,0,2*Math.PI),e.clip(),e.drawImage(i,n,a,o,o),e.restore()}}};t.default=r},"269cd":function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 页面左右间距 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/*文字颜色*/\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.qrcode[data-v-6d54954c]{padding:%?0?% 0 %?20?% 0;display:flex;align-items:center;justify-content:center}.title[data-v-6d54954c]{text-align:center}.canvas-box[data-v-6d54954c]{position:absolute;top:%?-88888?%}uni-page-body[data-v-6d54954c]{background-color:#f7f7f7}.invitePoster-box .bor-reu-8[data-v-6d54954c]{border-radius:%?8?%}.invitePoster-box .poster-box[data-v-6d54954c]{background-color:#fff;margin:%?30?% %?30?%;width:%?690?%;padding:%?40?% %?34?%;border-radius:%?8?%}.invitePoster-box .poster-box .header-img[data-v-6d54954c]{width:%?100?%;height:%?100?%;border-radius:50%}.invitePoster-box .poster-box .poster-img[data-v-6d54954c]{width:100%;height:%?414?%}.invitePoster-box .poster-box .title-lab[data-v-6d54954c]{width:%?400?%}.invitePoster-box .poster-box .spellNum[data-v-6d54954c]{background-color:#ffeddf;border-radius:%?22?%;width:%?144?%;height:%?44?%}.invitePoster-box .poster-box .code-img[data-v-6d54954c]{width:%?142?%;height:%?142?%}.invitePoster-box .poster-box .saveposter-but[data-v-6d54954c]{border-radius:%?5?%;background-color:#c5aa7b;color:#fff;width:%?420?%;height:%?66?%}body.?%PAGE?%[data-v-6d54954c]{background-color:#f7f7f7}',""]),e.exports=t},"4f14":function(e,t,n){var a=n("269cd");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=n("4f06").default;i("3948160f",a,!0,{sourceMap:!1,shadowMode:!1})},"679f":function(e,t,n){"use strict";n.r(t);var a=n("071b"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},"91c5":function(e,t,n){"use strict";var a=n("4f14"),i=n.n(a);i.a},"9e8c":function(e,t,n){"use strict";n.r(t);var a=n("b46e"),i=n("679f");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("91c5");var s,r=n("f0c5"),c=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,"6d54954c",null,!1,a["a"],s);t["default"]=c.exports},b1a1:function(e,t,n){"use strict";function a(e){if(0===e.indexOf("_www")||0===e.indexOf("_doc")||0===e.indexOf("_documents")||0===e.indexOf("_downloads"))return e;if(0===e.indexOf("file://"))return e;if(0===e.indexOf("/storage/emulated/0/"))return e;if(0===e.indexOf("/")){var t=plus.io.convertAbsoluteFileSystem(e);if(t!==e)return t;e=e.substr(1)}return"_www/"+e}function i(e){var t=e.split(",");return t[t.length-1]}n("c975"),n("ace4"),n("d3b7"),n("ac1f"),n("3ca3"),n("466d"),n("1276"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("2954"),n("649e"),n("219c"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d"),Object.defineProperty(t,"__esModule",{value:!0}),t.pathToBase64=c,t.base64ToPath=u;var o=0;function s(){return Date.now()+String(o++)}function r(e,t){for(var n=e.split("."),a=t.split("."),i=!1,o=0;o<a.length;o++){var s=n[o]-a[o];if(0!==s){i=s>0;break}}return i}function c(e){return new Promise((function(t,n){if("object"===typeof window&&"document"in window){if("function"===typeof FileReader){var i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="blob",i.onload=function(){if(200===this.status){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=n,e.readAsDataURL(this.response)}},i.onerror=n,void i.send()}var o=document.createElement("canvas"),s=o.getContext("2d"),r=new Image;return r.onload=function(){o.width=r.width,o.height=r.height,s.drawImage(r,0,0),t(o.toDataURL()),o.height=o.width=0},r.onerror=n,void(r.src=e)}"object"!==typeof plus?"object"===typeof wx&&wx.canIUse("getFileSystemManager")?wx.getFileSystemManager().readFile({filePath:e,encoding:"base64",success:function(e){t("data:image/png;base64,"+e.data)},fail:function(e){n(e)}}):n(new Error("not support")):plus.io.resolveLocalFileSystemURL(a(e),(function(e){e.file((function(e){var a=new plus.io.FileReader;a.onload=function(e){t(e.target.result)},a.onerror=function(e){n(e)},a.readAsDataURL(e)}),(function(e){n(e)}))}),(function(e){n(e)}))}))}function u(e){return new Promise((function(t,n){if("object"===typeof window&&"document"in window){e=e.split(",");var a=e[0].match(/:(.*?);/)[1],o=atob(e[1]),c=o.length,u=new Uint8Array(c);while(c--)u[c]=o.charCodeAt(c);return t((window.URL||window.webkitURL).createObjectURL(new Blob([u],{type:a})))}var l=e.split(",")[0].match(/data\:\S+\/(\S+);/);l?l=l[1]:n(new Error("base64 error"));var d=s()+"."+l;if("object"!==typeof plus)if("object"===typeof wx&&wx.canIUse("getFileSystemManager")){v=wx.env.USER_DATA_PATH+"/"+d;wx.getFileSystemManager().writeFile({filePath:v,data:i(e),encoding:"base64",success:function(){t(v)},fail:function(e){n(e)}})}else n(new Error("not support"));else{var f="_doc",p="uniapp_temp",v=f+"/"+p+"/"+d;if(!r("Android"===plus.os.name?"1.9.9.80627":"1.9.9.80472",plus.runtime.innerVersion))return void plus.io.resolveLocalFileSystemURL(f,(function(a){a.getDirectory(p,{create:!0,exclusive:!1},(function(a){a.getFile(d,{create:!0,exclusive:!1},(function(a){a.createWriter((function(a){a.onwrite=function(){t(v)},a.onerror=n,a.seek(0),a.writeAsBinary(i(e))}),n)}),n)}),n)}),n);var g=new plus.nativeObj.Bitmap(d);g.loadBase64Data(e,(function(){g.save(v,{},(function(){g.clear(),t(v)}),(function(e){g.clear(),n(e)}))}),(function(e){g.clear(),n(e)}))}}))}},b46e:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"invitePoster-box"},[n("v-uni-view",{staticClass:"poster-box flex-items-plus flex-column"},[n("v-uni-image",{staticClass:"header-img mar-top-10",attrs:{src:e.data.headImage}}),n("v-uni-label",{staticClass:"mar-top-30"},[e._v("发现一件好物，快来和我一起拼")]),n("v-uni-image",{staticClass:"poster-img mar-top-50",attrs:{src:e.data.image}}),n("v-uni-view",{staticClass:"flex-row-plus flex-sp-between mar-top-40"},[n("v-uni-view",{staticClass:"flex-column-plus"},[n("v-uni-label",{staticClass:"title-lab fs28"},[e._v(e._s(e.data.productName))]),n("v-uni-view",{staticClass:"spellNum flex-items-plus font-color-C5AA7B mar-top-30 fs24"},[e._v(e._s(e.data.person)+"人团")]),n("v-uni-view",{staticClass:"flex-row-plus mar-top-20 flex-items"},[n("v-uni-label",{staticClass:"font-color-C5AA7B fs24"},[e._v("¥")]),n("v-uni-label",{staticClass:"font-color-C5AA7B fs36 mar-left-5"},[e._v(e._s(e.data.price))]),n("v-uni-label",{staticClass:"font-color-999 fs26 mar-left-20"},[e._v("原价：¥"+e._s(e.data.originalPrice))])],1)],1),n("v-uni-view",{staticClass:"flex-column-plus flex-items-plus"},[n("v-uni-image",{staticStyle:{width:"180upx",height:"180upx"},attrs:{src:e.qrcode}}),n("v-uni-label",{staticClass:"font-color-666"},[e._v("扫描二维码")])],1)],1),n("v-uni-view",{staticClass:"saveposter-but flex-items-plus mar-top-50",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.savePoster(2)}}},[e._v("预览海报")])],1),n("v-uni-view",{staticClass:"bor-reu-8 pad-bot-30 canvas-box"},[n("v-uni-canvas",{staticStyle:{width:"720rpx",height:"1000rpx"},attrs:{"canvas-id":"posterCanvas",id:"posterCanvas"}})],1)],1)},o=[]}}]);